\doxysection{cr\+\_\+stack.\+c File Reference}
\hypertarget{cr__stack_8c}{}\label{cr__stack_8c}\index{cr\_stack.c@{cr\_stack.c}}


Contains the core of the Cygnus Reach firmware stack.  


{\ttfamily \#include $<$assert.\+h$>$}\newline
{\ttfamily \#include $<$stdarg.\+h$>$}\newline
{\ttfamily \#include $<$stdbool.\+h$>$}\newline
{\ttfamily \#include $<$stdint.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$time.\+h$>$}\newline
{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include "{}reach-\/server.\+h"{}}\newline
{\ttfamily \#include "{}cr\+\_\+stack.\+h"{}}\newline
{\ttfamily \#include "{}cr\+\_\+private.\+h"{}}\newline
{\ttfamily \#include "{}i3\+\_\+log.\+h"{}}\newline
{\ttfamily \#include "{}c\+JSON.\+h"{}}\newline
{\ttfamily \#include "{}pb\+\_\+decode.\+h"{}}\newline
{\ttfamily \#include "{}pb\+\_\+encode.\+h"{}}\newline
{\ttfamily \#include "{}message\+\_\+util.\+h"{}}\newline
{\ttfamily \#include "{}reach\+\_\+decode.\+h"{}}\newline
{\ttfamily \#include "{}reach\+\_\+version.\+h"{}}\newline
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{cr__stack_8c_a2ddabcc331f98de862032a6d4c0a75e7}\label{cr__stack_8c_a2ddabcc331f98de862032a6d4c0a75e7} 
\#define {\bfseries UNCODED\+\_\+\+PAYLOAD\+\_\+\+SIZE}~(CR\+\_\+\+CODED\+\_\+\+BUFFER\+\_\+\+SIZE-\/4)
\item 
\Hypertarget{cr__stack_8c_a4e5f2c04ed179641bfb6c8776698f94e}\label{cr__stack_8c_a4e5f2c04ed179641bfb6c8776698f94e} 
\#define {\bfseries ASYNC\+\_\+\+ERROR\+\_\+\+NOTIFCATION}
\item 
\Hypertarget{cr__stack_8c_adbceeaf83d3a9e89c45a8fbe308ba183}\label{cr__stack_8c_adbceeaf83d3a9e89c45a8fbe308ba183} 
\#define {\bfseries MAX\+\_\+\+BLE\+\_\+\+SZ}~CR\+\_\+\+CODED\+\_\+\+BUFFER\+\_\+\+SIZE
\item 
\Hypertarget{cr__stack_8c_a6aadb7fb05bd8dc5c84cd47fa37d7c64}\label{cr__stack_8c_a6aadb7fb05bd8dc5c84cd47fa37d7c64} 
\#define {\bfseries MAX\+\_\+\+RAW\+\_\+\+SZ}~CR\+\_\+\+DECODED\+\_\+\+BUFFER\+\_\+\+SIZE
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{cr__stack_8c_a19c76f06e3d764396d9767b558dbd15d}\label{cr__stack_8c_a19c76f06e3d764396d9767b558dbd15d} 
bool {\bfseries pvt\+Cr\+\_\+challenge\+\_\+key\+\_\+is\+\_\+valid} (void)
\begin{DoxyCompactList}\small\item\em Returns the state of the challenge key which may block access to the Reach interface. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{cr__stack_8c_aa30199827c6ac809190a2494b2a66a13}{cr\+\_\+init}} ()
\begin{DoxyCompactList}\small\item\em cr\+\_\+init \end{DoxyCompactList}\item 
\Hypertarget{cr__stack_8c_a16d910a820e7f9337216cd623d55e66f}\label{cr__stack_8c_a16d910a820e7f9337216cd623d55e66f} 
int {\bfseries cr\+\_\+set\+\_\+advertised\+\_\+name} (char \texorpdfstring{$\ast$}{*}name, int length)
\item 
const char \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{cr__stack_8c_a0455e201acdd200cfad17c663073a491}{cr\+\_\+get\+\_\+advertised\+\_\+name}} ()
\begin{DoxyCompactList}\small\item\em cr\+\_\+get\+\_\+advertised\+\_\+name \end{DoxyCompactList}\item 
int \mbox{\hyperlink{cr__stack_8c_af1732a5d9ee5f83c4360448ae4452b34}{cr\+\_\+store\+\_\+coded\+\_\+prompt}} (uint8\+\_\+t \texorpdfstring{$\ast$}{*}data, size\+\_\+t len)
\begin{DoxyCompactList}\small\item\em cr\+\_\+set\+\_\+advertised\+\_\+name \end{DoxyCompactList}\item 
\Hypertarget{cr__stack_8c_ab475ae83a3ac8917b289852d0a0aa6ec}\label{cr__stack_8c_ab475ae83a3ac8917b289852d0a0aa6ec} 
int {\bfseries cr\+\_\+get\+\_\+coded\+\_\+response\+\_\+buffer} (uint8\+\_\+t \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}p\+Response, size\+\_\+t \texorpdfstring{$\ast$}{*}len)
\item 
\Hypertarget{cr__stack_8c_ad28b6060e7d1c0641b0a6571995f656d}\label{cr__stack_8c_ad28b6060e7d1c0641b0a6571995f656d} 
int {\bfseries cr\+\_\+process} (uint32\+\_\+t ticks)
\item 
\Hypertarget{cr__stack_8c_ac3be80269e1e885655edb9f3bdea2e96}\label{cr__stack_8c_ac3be80269e1e885655edb9f3bdea2e96} 
uint32\+\_\+t {\bfseries cr\+\_\+get\+\_\+current\+\_\+ticks} ()
\item 
\Hypertarget{cr__stack_8c_a309d1592e6bca704064924348b5faa67}\label{cr__stack_8c_a309d1592e6bca704064924348b5faa67} 
void {\bfseries cr\+\_\+set\+\_\+ble\+\_\+connected} (bool connected)
\item 
\Hypertarget{cr__stack_8c_a4aebef6306c8823d394d73df04684a86}\label{cr__stack_8c_a4aebef6306c8823d394d73df04684a86} 
bool {\bfseries cr\+\_\+get\+\_\+ble\+\_\+connected} (void)
\item 
\Hypertarget{cr__stack_8c_a516393a2f8a30416f04285bf3dbcd010}\label{cr__stack_8c_a516393a2f8a30416f04285bf3dbcd010} 
void {\bfseries cr\+\_\+report\+\_\+error} (int error\+\_\+code, const char \texorpdfstring{$\ast$}{*}fmt,...)
\item 
\Hypertarget{cr__stack_8c_a16ccedefa64bb122fda0990567e8499c}\label{cr__stack_8c_a16ccedefa64bb122fda0990567e8499c} 
void {\bfseries cr\+\_\+test\+\_\+sizes} ()
\item 
\Hypertarget{cr__stack_8c_ac4de55cd1a8df4e01f0dbc1fb788284f}\label{cr__stack_8c_ac4de55cd1a8df4e01f0dbc1fb788284f} 
const char \texorpdfstring{$\ast$}{*} {\bfseries cr\+\_\+get\+\_\+reach\+\_\+version} ()
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{cr__stack_8c_ad8991609e7b79f8c29f525ff481e33bd}\label{cr__stack_8c_ad8991609e7b79f8c29f525ff481e33bd} 
cr\+\_\+\+Reach\+Message\+Types {\bfseries pvt\+Cr\+\_\+continued\+\_\+message\+\_\+type}
\begin{DoxyCompactList}\small\item\em Private variables controlling the sort of continuing transactions used by file transfers, etc. \end{DoxyCompactList}\item 
\Hypertarget{cr__stack_8c_a6525cf21916ad2b0b996a31aba66d80a}\label{cr__stack_8c_a6525cf21916ad2b0b996a31aba66d80a} 
uint32\+\_\+t {\bfseries pvt\+Cr\+\_\+num\+\_\+continued\+\_\+objects} = 0
\item 
\Hypertarget{cr__stack_8c_a4b3a18d3c66251fdfb9093f8708b0fc0}\label{cr__stack_8c_a4b3a18d3c66251fdfb9093f8708b0fc0} 
uint32\+\_\+t {\bfseries pvt\+Cr\+\_\+num\+\_\+remaining\+\_\+objects} = 0
\item 
char \mbox{\hyperlink{cr__stack_8c_a507defe644b6bd5d985a50059d4006d4}{s\+Cr\+\_\+advertised\+\_\+name}} \mbox{[}REACH\+\_\+\+SHORT\+\_\+\+STRING\+\_\+\+LEN\mbox{]}
\begin{DoxyCompactList}\small\item\em cr\+\_\+set\+\_\+advertised\+\_\+name \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Contains the core of the Cygnus Reach firmware stack. 

\begin{DoxyAuthor}{Author}
Chuck Peplinski 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
2024-\/01-\/18 
\end{DoxyDate}
\begin{DoxyCopyright}{Copyright}
(c) Copyright 2023 i3 Product Development. All Rights Reserved. The Cygngus Reach firmware stack is shared under an MIT license. 
\end{DoxyCopyright}


\doxysubsection{Function Documentation}
\Hypertarget{cr__stack_8c_a0455e201acdd200cfad17c663073a491}\label{cr__stack_8c_a0455e201acdd200cfad17c663073a491} 
\index{cr\_stack.c@{cr\_stack.c}!cr\_get\_advertised\_name@{cr\_get\_advertised\_name}}
\index{cr\_get\_advertised\_name@{cr\_get\_advertised\_name}!cr\_stack.c@{cr\_stack.c}}
\doxysubsubsection{\texorpdfstring{cr\_get\_advertised\_name()}{cr\_get\_advertised\_name()}}
{\footnotesize\ttfamily const char \texorpdfstring{$\ast$}{*} cr\+\_\+get\+\_\+advertised\+\_\+name (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



cr\+\_\+get\+\_\+advertised\+\_\+name 

Retrieves the name stored by cr\+\_\+set\+\_\+advertised\+\_\+name(). \begin{DoxyReturn}{Returns}
pointer to a string of length REACH\+\_\+\+SHORT\+\_\+\+STRING\+\_\+\+LEN. 
\end{DoxyReturn}
\Hypertarget{cr__stack_8c_aa30199827c6ac809190a2494b2a66a13}\label{cr__stack_8c_aa30199827c6ac809190a2494b2a66a13} 
\index{cr\_stack.c@{cr\_stack.c}!cr\_init@{cr\_init}}
\index{cr\_init@{cr\_init}!cr\_stack.c@{cr\_stack.c}}
\doxysubsubsection{\texorpdfstring{cr\_init()}{cr\_init()}}
{\footnotesize\ttfamily int cr\+\_\+init (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



cr\+\_\+init 

To be called before starting the stack. \begin{DoxyNote}{Note}
Not much happens here yet. 
\end{DoxyNote}
\begin{DoxyReturn}{Returns}
cr\+\_\+\+Error\+Codes\+\_\+\+NO\+\_\+\+ERROR or a non-\/zero error like cr\+\_\+\+Error\+Codes\+\_\+. 
\end{DoxyReturn}
\Hypertarget{cr__stack_8c_af1732a5d9ee5f83c4360448ae4452b34}\label{cr__stack_8c_af1732a5d9ee5f83c4360448ae4452b34} 
\index{cr\_stack.c@{cr\_stack.c}!cr\_store\_coded\_prompt@{cr\_store\_coded\_prompt}}
\index{cr\_store\_coded\_prompt@{cr\_store\_coded\_prompt}!cr\_stack.c@{cr\_stack.c}}
\doxysubsubsection{\texorpdfstring{cr\_store\_coded\_prompt()}{cr\_store\_coded\_prompt()}}
{\footnotesize\ttfamily int cr\+\_\+store\+\_\+coded\+\_\+prompt (\begin{DoxyParamCaption}\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{data,  }\item[{size\+\_\+t}]{len }\end{DoxyParamCaption})}



cr\+\_\+set\+\_\+advertised\+\_\+name 

Set the name of the device that should be advertised before connecting. Used in BLE. \begin{DoxyNote}{Note}
Just store the string up to length REACH\+\_\+\+SHORT\+\_\+\+STRING\+\_\+\+LEN. The code setting up the link can retrieve this using \doxylink{cr__stack_8c_a0455e201acdd200cfad17c663073a491}{cr\+\_\+get\+\_\+advertised\+\_\+name()} 
\end{DoxyNote}
\begin{DoxyReturn}{Returns}
cr\+\_\+\+Error\+Codes\+\_\+\+NO\+\_\+\+ERROR or a non-\/zero error code. 
\end{DoxyReturn}


\doxysubsection{Variable Documentation}
\Hypertarget{cr__stack_8c_a507defe644b6bd5d985a50059d4006d4}\label{cr__stack_8c_a507defe644b6bd5d985a50059d4006d4} 
\index{cr\_stack.c@{cr\_stack.c}!sCr\_advertised\_name@{sCr\_advertised\_name}}
\index{sCr\_advertised\_name@{sCr\_advertised\_name}!cr\_stack.c@{cr\_stack.c}}
\doxysubsubsection{\texorpdfstring{sCr\_advertised\_name}{sCr\_advertised\_name}}
{\footnotesize\ttfamily char s\+Cr\+\_\+advertised\+\_\+name\mbox{[}REACH\+\_\+\+SHORT\+\_\+\+STRING\+\_\+\+LEN\mbox{]}}



cr\+\_\+set\+\_\+advertised\+\_\+name 

Set the name of the device that should be advertised before connecting. Used in BLE. \begin{DoxyNote}{Note}
Just store the string up to length REACH\+\_\+\+SHORT\+\_\+\+STRING\+\_\+\+LEN. The code setting up the link can retrieve this using \doxylink{cr__stack_8c_a0455e201acdd200cfad17c663073a491}{cr\+\_\+get\+\_\+advertised\+\_\+name()} 
\end{DoxyNote}
\begin{DoxyReturn}{Returns}
cr\+\_\+\+Error\+Codes\+\_\+\+NO\+\_\+\+ERROR or a non-\/zero error code. 
\end{DoxyReturn}
